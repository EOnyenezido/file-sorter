<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_261) on Sat Nov 07 21:04:22 WAT 2020 -->
<title>FileSorter</title>
<meta name="date" content="2020-11-07">
<link rel="stylesheet" type="text/css" href="../stylesheet.css" title="Style">
<script type="text/javascript" src="../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="FileSorter";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":9,"i1":9,"i2":9,"i3":9,"i4":9,"i5":9,"i6":9};
var tabs = {65535:["t0","All Methods"],1:["t1","Static Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../ExternalSorting/package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../deprecated-list.html">Deprecated</a></li>
<li><a href="../index-all.html">Index</a></li>
<li><a href="../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../ExternalSorting/CachedScanner.html" title="class in ExternalSorting"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li>Next&nbsp;Class</li>
</ul>
<ul class="navList">
<li><a href="../index.html?ExternalSorting/FileSorter.html" target="_top">Frames</a></li>
<li><a href="FileSorter.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">ExternalSorting</div>
<h2 title="Class FileSorter" class="title">Class FileSorter</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>ExternalSorting.FileSorter</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public class <span class="typeNameLabel">FileSorter</span>
extends java.lang.Object</pre>
<div class="block">Sorts a large input file by splitting it into sorted temp files and merging them into a sorted output file.

 This class essentially takes in a large file, and uses an estimate of the free memory to split the file
 into sorted chunks that fit in the free memory and saves these chunks as temp files.

 It then merges the sorted temp files using the merge k sorted lists algorithm to produce a final sorted file</div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../ExternalSorting/FileSorter.html#FileSorter-java.util.Properties-">FileSorter</a></span>(java.util.Properties&nbsp;props)</code>
<div class="block">Constructor for initializing an instance with custom properties.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t1" class="tableTab"><span><a href="javascript:show(1);">Static Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>static java.util.List&lt;java.io.File&gt;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../ExternalSorting/FileSorter.html#createSortedTempFiles-long-int-long-java.util.Scanner-java.util.Comparator-java.io.File-">createSortedTempFiles</a></span>(long&nbsp;fileSize,
                     int&nbsp;maxTmpFiles,
                     long&nbsp;freeMemory,
                     java.util.Scanner&nbsp;fileScanner,
                     java.util.Comparator&lt;java.lang.String&gt;&nbsp;comparator,
                     java.io.File&nbsp;tmpDirectory)</code>
<div class="block">This method essentially takes a large file and scans a set block into memory
 This block is then sorted and saved to a temp file.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>static long</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../ExternalSorting/FileSorter.html#getEstimatedBlockSize-long-int-long-">getEstimatedBlockSize</a></span>(long&nbsp;fileSize,
                     int&nbsp;maxTmpFiles,
                     long&nbsp;freeMemory)</code>
<div class="block">This method estimates a block size which is how much data we can read into memory at a chunk
 It also ensures that this block size is not more than the free memory and not
 excessively less than free memory such that it becomes inefficient</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code>static long</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../ExternalSorting/FileSorter.html#getEstimatedFreeMemory--">getEstimatedFreeMemory</a></span>()</code>
<div class="block">This method essentially attempts to estimate the available free memory.</div>
</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code>static long</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../ExternalSorting/FileSorter.html#getEstimatedStringSize-java.lang.String-">getEstimatedStringSize</a></span>(java.lang.String&nbsp;str)</code>
<div class="block">This method essentially estimates a string size in bytes
 It estimates 2 bytes per character plus an object overheard
 based on the JVM bit size</div>
</td>
</tr>
<tr id="i4" class="altColor">
<td class="colFirst"><code>static void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../ExternalSorting/FileSorter.html#main-java.lang.String:A-">main</a></span>(java.lang.String[]&nbsp;args)</code>&nbsp;</td>
</tr>
<tr id="i5" class="rowColor">
<td class="colFirst"><code>static void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../ExternalSorting/FileSorter.html#mergeSortedTempFiles-java.util.Comparator-java.util.List-java.io.BufferedWriter-int-">mergeSortedTempFiles</a></span>(java.util.Comparator&lt;java.lang.String&gt;&nbsp;comparator,
                    java.util.List&lt;java.io.File&gt;&nbsp;tmpFiles,
                    java.io.BufferedWriter&nbsp;fileWriter,
                    int&nbsp;wordWrap)</code>
<div class="block">This uses a min/max heap and the merge k sorted lists algorithm to merge the sorted temp files.</div>
</td>
</tr>
<tr id="i6" class="altColor">
<td class="colFirst"><code>static java.io.File</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../ExternalSorting/FileSorter.html#sortAndSaveTempFile-java.util.List-java.util.Comparator-java.io.File-">sortAndSaveTempFile</a></span>(java.util.List&lt;java.lang.String&gt;&nbsp;unsortedLineChunk,
                   java.util.Comparator&lt;java.lang.String&gt;&nbsp;comparator,
                   java.io.File&nbsp;tmpDirectory)</code>
<div class="block">This method sorts a chunk of words that are within the block size limit
 and saves the sorted chunk to a temp file to clear up memory for the next chunk.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="FileSorter-java.util.Properties-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>FileSorter</h4>
<pre>public&nbsp;FileSorter(java.util.Properties&nbsp;props)</pre>
<div class="block">Constructor for initializing an instance with custom properties.
 Properties can be null if so it defaults to internal values.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>props</code> - Properties object containing maxTmpFiles, inputFile, outputFile,
              order, wordWrap and tmpFilesDirectory</dd>
</dl>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="getEstimatedFreeMemory--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getEstimatedFreeMemory</h4>
<pre>public static&nbsp;long&nbsp;getEstimatedFreeMemory()</pre>
<div class="block">This method essentially attempts to estimate the available free memory.
 It first calls the gc to clear up unused objects and then estimates the
 free memory is the configured max memory -Xmx/mx minus the used memory</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The estimated free memory</dd>
</dl>
</li>
</ul>
<a name="getEstimatedBlockSize-long-int-long-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getEstimatedBlockSize</h4>
<pre>public static&nbsp;long&nbsp;getEstimatedBlockSize(long&nbsp;fileSize,
                                         int&nbsp;maxTmpFiles,
                                         long&nbsp;freeMemory)
                                  throws java.lang.Exception</pre>
<div class="block">This method estimates a block size which is how much data we can read into memory at a chunk
 It also ensures that this block size is not more than the free memory and not
 excessively less than free memory such that it becomes inefficient</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>fileSize</code> - The size of the input file to be processed</dd>
<dd><code>maxTmpFiles</code> - The maximum number of temp files to create</dd>
<dd><code>freeMemory</code> - The amount of JVM memory that is free and available for use</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The estimated size of a block which we can read into memory safely</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.Exception</code> - If the estimated block size is above the free memory then the file cannot be processed
                   unless the maxTmpFiles is increased</dd>
</dl>
</li>
</ul>
<a name="getEstimatedStringSize-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getEstimatedStringSize</h4>
<pre>public static&nbsp;long&nbsp;getEstimatedStringSize(java.lang.String&nbsp;str)</pre>
<div class="block">This method essentially estimates a string size in bytes
 It estimates 2 bytes per character plus an object overheard
 based on the JVM bit size</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>str</code> - String for which to estimate size</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The estimated string size</dd>
</dl>
</li>
</ul>
<a name="sortAndSaveTempFile-java.util.List-java.util.Comparator-java.io.File-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>sortAndSaveTempFile</h4>
<pre>public static&nbsp;java.io.File&nbsp;sortAndSaveTempFile(java.util.List&lt;java.lang.String&gt;&nbsp;unsortedLineChunk,
                                               java.util.Comparator&lt;java.lang.String&gt;&nbsp;comparator,
                                               java.io.File&nbsp;tmpDirectory)
                                        throws java.io.IOException</pre>
<div class="block">This method sorts a chunk of words that are within the block size limit
 and saves the sorted chunk to a temp file to clear up memory for the next chunk.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>unsortedLineChunk</code> - A list of words to sort and save in a temp file</dd>
<dd><code>comparator</code> - Comparator to use to sort the list of words</dd>
<dd><code>tmpDirectory</code> - Directory to save the sorted temp file</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The sorted temp file</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.io.IOException</code> - General IOException if unable to access any file(s)</dd>
</dl>
</li>
</ul>
<a name="mergeSortedTempFiles-java.util.Comparator-java.util.List-java.io.BufferedWriter-int-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>mergeSortedTempFiles</h4>
<pre>public static&nbsp;void&nbsp;mergeSortedTempFiles(java.util.Comparator&lt;java.lang.String&gt;&nbsp;comparator,
                                        java.util.List&lt;java.io.File&gt;&nbsp;tmpFiles,
                                        java.io.BufferedWriter&nbsp;fileWriter,
                                        int&nbsp;wordWrap)
                                 throws java.io.IOException</pre>
<div class="block">This uses a min/max heap and the merge k sorted lists algorithm to merge the sorted temp files.

 Why use java.util.Scanner here instead of java.io.BufferedFileReader? The scanner uses
 a smaller buffer than the buffered reader and since the files are sorted word for word, it is
 more memory efficient to read a single word than to read a line chunk and split it into words</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>comparator</code> - Comparator for merging the words in the sorted temp files</dd>
<dd><code>tmpFiles</code> - A list of the sorted temp files to be merged into output file</dd>
<dd><code>fileWriter</code> - A simple buffered file writer for writing the output file</dd>
<dd><code>wordWrap</code> - Number of words before wrapping to a new line</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.io.IOException</code> - General IOException if unable to access any file(s)</dd>
</dl>
</li>
</ul>
<a name="createSortedTempFiles-long-int-long-java.util.Scanner-java.util.Comparator-java.io.File-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>createSortedTempFiles</h4>
<pre>public static&nbsp;java.util.List&lt;java.io.File&gt;&nbsp;createSortedTempFiles(long&nbsp;fileSize,
                                                                 int&nbsp;maxTmpFiles,
                                                                 long&nbsp;freeMemory,
                                                                 java.util.Scanner&nbsp;fileScanner,
                                                                 java.util.Comparator&lt;java.lang.String&gt;&nbsp;comparator,
                                                                 java.io.File&nbsp;tmpDirectory)
                                                          throws java.lang.Exception</pre>
<div class="block">This method essentially takes a large file and scans a set block into memory
 This block is then sorted and saved to a temp file. The list of temp files are
 returned so they can be merged into a new output file</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>fileSize</code> - Size of the input file, used to estimate block size</dd>
<dd><code>maxTmpFiles</code> - Maximum number of temporary files to create, used to estimate block size</dd>
<dd><code>freeMemory</code> - Estimated free memory, used to estimate block size</dd>
<dd><code>fileScanner</code> - Scanner for the input file to be sorted</dd>
<dd><code>comparator</code> - Comparator used to sort the words, ascending or descending order</dd>
<dd><code>tmpDirectory</code> - Directory to place the temp files, files will be deleted after</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The list of the sorted temp files</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.Exception</code> - If unable to read from the input file or save a temp file</dd>
</dl>
</li>
</ul>
<a name="main-java.lang.String:A-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>main</h4>
<pre>public static&nbsp;void&nbsp;main(java.lang.String[]&nbsp;args)
                 throws java.lang.Exception</pre>
<dl>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../ExternalSorting/package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../deprecated-list.html">Deprecated</a></li>
<li><a href="../index-all.html">Index</a></li>
<li><a href="../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../ExternalSorting/CachedScanner.html" title="class in ExternalSorting"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li>Next&nbsp;Class</li>
</ul>
<ul class="navList">
<li><a href="../index.html?ExternalSorting/FileSorter.html" target="_top">Frames</a></li>
<li><a href="FileSorter.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
